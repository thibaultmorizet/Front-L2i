<div class="general-content">
  <app-header [cartLength]="cart.length"></app-header>

  <main id="content">
    <div class="container">
      <div class="filter-list-search-bar">
        <div>
          <p-multiSelect
            [options]="formats"
            [(ngModel)]="selectedFormat"
            defaultLabel="Format"
            optionLabel="name"
            display="chip"
            (onChange)="getBooksWithFormatAndTypeAndPriceAndSearch()"
          ></p-multiSelect>
        </div>
        <div>
          <p-multiSelect
            [options]="types"
            [(ngModel)]="selectedType"
            defaultLabel="Type"
            optionLabel="name"
            display="chip"
            (onChange)="getBooksWithFormatAndTypeAndPriceAndSearch()"
          ></p-multiSelect>
        </div>
        <div class="my-5">
          <h5>
            Range:
            {{ selectedPriceRange[0] + " € - " + selectedPriceRange[1] + " €" }}
          </h5>
          <p-slider
            [(ngModel)]="selectedPriceRange"
            [range]="true"
            (onSlideEnd)="getBooksWithFormatAndTypeAndPriceAndSearch()"
            [min]="0"
            [max]="maxPrice"
          ></p-slider>
        </div>
        <div>
          <button
            pButton
            pRipple
            type="button"
            class="p-button-raised"
            [ngClass]="{
              'p-button-primary-color': showBooksInStock,
              'btn-primary-color': showBooksInStock,
              'p-button-outline-primary-color': !showBooksInStock,
              'btn-outline-primary-color': !showBooksInStock
            }"
            (click)="showBooksInStock = !showBooksInStock"
          >
            <span *ngIf="showBooksInStock">Only books in stock</span>
            <span *ngIf="!showBooksInStock">Only books out of stock</span>
          </button>
        </div>
        <div>
          <p-autoComplete
            placeholder="Search"
            [(ngModel)]="searchBook"
            [showEmptyMessage]="true"
            [suggestions]="filteredBooks"
            (completeMethod)="filterBook($event)"
            field="title"
            [minLength]="1"
            (onSelect)="getBooksWithFormatAndTypeAndPriceAndSearch()"
            (onBlur)="getBooksWithFormatAndTypeAndPriceAndSearch()"
          ></p-autoComplete>
          <button
            type="button"
            class="btn btn-primary button-search h-100"
            (click)="getBooksWithFormatAndTypeAndPriceAndSearch()"
          >
            <i class="fa fa-search"></i>
          </button>
        </div>
        <div>
          <button
            pButton
            pRipple
            type="button"
            class="p-button-raised p-button-just-text"
          >
            Clear All
          </button>
        </div>
      </div>
      <div></div>

      <!--       <div class="row">
        <div id="search" class="">
          <div class="container d-flex justify-content-end">
            <form
              #searchForm="ngForm"
              role="search"
              (ngSubmit)="getBooksWithFormatAndTypeAndPriceAndSearch()"
            >
              <div class="input-group">
                <input
                  type="text"
                  placeholder="Recherche"
                  class="form-control"
                  value="{{ searchBook }}"
                  [(ngModel)]="searchBook"
                  name="searchbar"
                  list="searchList"
                />
                <datalist *ngIf="searchBook.length > 0" id="searchList">
                  <option *ngFor="let elt of allBooks" [value]="elt.title">
                    {{ elt.title }}
                  </option>
                </datalist>

                <div class="input-group-append">
                  <button
                    type="submit"
                    class="btn btn-primary button-search h-100"
                  >
                    <i class="fa fa-search"></i>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <div class="col-lg-3">
          <div class="card sidebar-menu mb-4">
            <div class="card-header">
              <h3 class="h4 card-title d-flex justify-content-between">
                Format
                <button
                  (click)="removeFormatFilter()"
                  class="btn btn-sm btn-danger pull-right"
                >
                  <i class="fa fa-times-circle"></i> Effacer
                </button>
              </h3>
            </div>
            <div class="card-body">
              <form
                #monForm="ngForm"
                class="container"
                (ngSubmit)="getBooksWithFormatAndTypeAndPriceAndSearch()"
              >
                <div class="form-group" *ngFor="let elt of formats">
                  <div class="checkbox">
                    <label>
                      <input
                        type="checkbox"
                        name="format"
                        value="{{ elt.name }}"
                        [(ngModel)]="elt.filter_is_selected"
                        [checked]="elt.filter_is_selected"
                      />
                      {{ elt.name }} ({{ elt.count_books }})</label
                    >
                  </div>
                </div>
                <button
                  type="submit"
                  class="btn btn-default btn-sm btn-primary"
                >
                  <i class="fa fa-pencil"></i> Appliquer
                </button>
              </form>
            </div>
          </div>
          <div class="card sidebar-menu mb-4">
            <div class="card-header">
              <h3 class="h4 card-title d-flex justify-content-between">
                Type
                <button
                  (click)="removeTypeFilter()"
                  class="btn btn-sm btn-danger pull-right"
                >
                  <i class="fa fa-times-circle"></i> Effacer
                </button>
              </h3>
            </div>
            <div class="card-body">
              <form
                #monForm="ngForm"
                class="container"
                (ngSubmit)="getBooksWithFormatAndTypeAndPriceAndSearch()"
              >
                <div class="form-group" *ngFor="let elt of types">
                  <div class="checkbox">
                    <label>
                      <input
                        type="checkbox"
                        name="type"
                        value="{{ elt.name }}"
                        [(ngModel)]="elt.filter_is_selected"
                        [checked]="elt.filter_is_selected"
                      />
                      {{ elt.name }} ({{ elt.count_books }})</label
                    >
                  </div>
                </div>
                <button
                  type="submit"
                  class="btn btn-default btn-sm btn-primary"
                >
                  <i class="fa fa-pencil"></i> Appliquer
                </button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-lg-9">
          <div class="row">
            <div *ngFor="let elt of books" class="col-lg-4 col-md-6 mb-5">
              <ng-template #updatebookContent let-modal>
                <div class="modal-header">
                  <h4 class="modal-title" id="modal-basic-title">
                    Modifier le livre
                  </h4>
                  <button
                    type="button"
                    class="btn-close"
                    aria-label="Close"
                    (click)="modal.dismiss('Cross click')"
                  ></button>
                </div>
                <div class="modal-body">
                  <form #updatebookForm="ngForm" (ngSubmit)="updatebook()">
                    <div class="mb-3">
                      <label class="mb-2" for="title">Titre</label>
                      <div class="input-group">
                        <input
                          type="text"
                          placeholder="{{ elt.title }}"
                          class="form-control mb-3"
                          value="{{ elt.title }}"
                          [(ngModel)]="actualUpdatebook.title"
                          name="title"
                          required
                        />
                      </div>

                      <label class="mb-2" for="summary">Description</label>
                      <div class="input-group">
                        <textarea
                          placeholder="{{ elt.summary }}"
                          class="form-control mb-3"
                          value="{{ elt.summary }}"
                          [(ngModel)]="actualUpdatebook.summary"
                          name="summary"
                          cols="30"
                          rows="10"
                          required
                        ></textarea>
                      </div>

                      <label class="mb-2" for="unitPriceTtc">Prix unitaire</label>
                      <div class="input-group">
                        <input
                          type="number"
                          step="0.01"
                          min="0"
                          placeholder="{{ elt.unitpricettc }}"
                          class="form-control mb-3"
                          value="{{ elt.unitpricettc }}"
                          [(ngModel)]="actualUpdatebook.unitpricettc"
                          name="unitPriceTtc"
                          required
                        />
                      </div>

                      <label class="mb-2" for="stock">Stock</label>
                      <div class="input-group">
                        <input
                          type="number"
                          step="1"
                          min="0"
                          placeholder="{{ elt.stock }}"
                          class="form-control mb-3"
                          value="{{ elt.stock }}"
                          [(ngModel)]="actualUpdatebook.stock"
                          name="stock"
                          required
                        />
                      </div>

                      <label class="mb-2" for="isbn">ISBN</label>
                      <div class="input-group">
                        <input
                          type="text"
                          placeholder="{{ elt.isbn }}"
                          class="form-control mb-3"
                          value="{{ elt.isbn }}"
                          [(ngModel)]="actualUpdatebook.isbn"
                          name="isbn"
                          required
                        />
                      </div>

                      <label class="mb-2" for="year">Année de parution</label>
                      <div class="input-group">
                        <input
                          type="text"
                          placeholder="{{ elt.year }}"
                          class="form-control mb-3"
                          value="{{ elt.year }}"
                          [(ngModel)]="actualUpdatebook.year"
                          name="year"
                          required
                        />
                      </div>

                      <fieldset>
                        <legend>Format :</legend>
                        <div *ngFor="let aFormat of formats">
                          <input
                            type="radio"
                            name="format"
                            id="{{ aFormat.name }}"
                            [value]="aFormat"
                            [(ngModel)]="actualUpdatebook.format"
                            ng-checked="true"
                          />

                          <label for="{{ aFormat.name }}">{{
                            aFormat.name
                          }}</label>
                        </div>
                      </fieldset>

                      <fieldset>
                        <legend>Éditeur :</legend>
                        <div *ngFor="let anEditor of editors">
                          <input
                            type="radio"
                            name="editor"
                            id="{{ anEditor.name }}"
                            [value]="anEditor"
                            [(ngModel)]="actualUpdatebook.editor"
                          />

                          <label for="{{ anEditor.name }}"
                            >{{ anEditor.name }}
                          </label>
                        </div>
                      </fieldset>

                      <fieldset>
                        <legend>Auteurs :</legend>
                        <div *ngFor="let anAuthor of authors">
                          <input
                            type="checkbox"
                            name="{{ anAuthor.firstname }}_{{
                              anAuthor.lastname
                            }}"
                            id="{{ anAuthor.firstname }}_{{
                              anAuthor.lastname
                            }}"
                            [checked]="anAuthor.isChecked"
                            [(ngModel)]="anAuthor.isChecked"
                          />

                          <label
                            for="{{ anAuthor.firstname }}_{{
                              anAuthor.lastname
                            }}"
                            >{{ anAuthor.firstname }}
                            {{ anAuthor.lastname }}</label
                          >
                        </div>
                      </fieldset>

                      <fieldset>
                        <legend>Types :</legend>
                        <div *ngFor="let aType of types">
                          <input
                            type="checkbox"
                            name="{{ aType.name }}"
                            id="{{ aType.name }}"
                            [checked]="aType.isChecked"
                            [(ngModel)]="aType.isChecked"
                          />

                          <label for="{{ aType.name }}">{{ aType.name }}</label>
                        </div>
                      </fieldset>

                      <label class="mb-2" for="coverImage"
                        >Image de couverture</label
                      >
                      <div class="input-group">
                        <input
                          #imageInput
                          type="file"
                          accept="image/*"
                          class="form-control mb-3 file-upload"
                          (change)="uploadFile(imageInput)"
                          name="coverImage"
                        />
                      </div>

                      <div class="d-flex justify-content-end mt-2">
                        <button
                          type="submit"
                          class="btn btn-default btn-sm btn-primary"
                          [disabled]="!updatebookForm.valid"
                        >
                          Modifier le livre
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
              </ng-template>

              <div class="product h-100 d-flex align-items-center flex-column">
                <div class="">
                  <div class="update-book-admin-container">
                    <span
                      class="update-book-admin text-white pointer"
                      (click)="updatebookModal(updatebookContent, elt.id)"
                      *ngIf="connectedUser?.roles?.includes('ROLE_ADMIN')"
                    >
                      <i class="fa-solid fa-pen-to-square"></i
                    ></span>
                    <a [routerLink]="['/books/', elt.id]">
                      <img
                        src="{{ elt.image }}"
                        alt=""
                        class="img-book-details"
                    /></a>
                  </div>
                </div>

                <div class="text p-2 mt-auto w-100">
                  <h3>
                    <a [routerLink]="['/books/', elt.id]">
                      {{ elt.title }}
                    </a>
                  </h3>
                  <p class="price"><del></del>{{ elt.unitpricettc }} €</p>
                  <div class="d-flex justify-content-between px-1">
                    <button
                      [routerLink]="['/books/', elt.id]"
                      class="btn btn-outline-secondary col-5 mt-4"
                    >
                      Voir le détail
                    </button>
                    <div class="col-6">
                      <form
                        #addBookForm="ngForm"
                        (ngSubmit)="addBookToCart($event, elt.id)"
                      >
                        Quantité :
                        <select id="quantity_to_order" name="quantity_to_order">
                          <option
                            *ngFor="
                              let quantity of [
                                1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
                                15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,
                                27, 28, 29, 30
                              ]
                            "
                            value="{{ quantity }}"
                            [selected]="quantity == 1"
                          >
                            {{ quantity }}
                          </option>
                        </select>
                        <button type="submit" class="btn btn-primary mt-2">
                          <i class="fa fa-shopping-cart"></i>Ajouter au panier
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="pages">
              <nav
                aria-label="Page navigation example"
                class="d-flex justify-content-center"
              >
                <ul class="pagination">
                  <li class="page-item">
                    <button
                      [disabled]="actualPage == 1"
                      (click)="getPreviousPage()"
                      type="button"
                      aria-label="Previous"
                      class="page-link"
                    >
                      <span aria-hidden="true">«</span
                      ><span class="sr-only">Previous</span>
                    </button>
                  </li>
                  <div *ngFor="let i of paginationArray">
                    <li *ngIf="i == actualPage" class="page-item active">
                      <button
                        (click)="getAllBooksByPage(i)"
                        type="button"
                        class="page-link"
                      >
                        {{ i }}
                      </button>
                    </li>
                    <li *ngIf="i != actualPage" class="page-item">
                      <button
                        (click)="getAllBooksByPage(i)"
                        type="button"
                        class="page-link"
                      >
                        {{ i }}
                      </button>
                    </li>
                  </div>
                  <li class="page-item">
                    <button
                      [disabled]="actualPage == pageCount"
                      (click)="getNextPage()"
                      type="button"
                      aria-label="Next"
                      class="page-link"
                    >
                      <span aria-hidden="true">»</span
                      ><span class="sr-only">Next</span>
                    </button>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
 -->
    </div>
  </main>
  <app-footer></app-footer>
</div>
