<div class="general-content">
  <app-header [basketLength]="basket.length"></app-header>

  <main id="content">
    <div class="container" *ngIf="!connectedUser.id && isLoginPage">
      <div class="login-container">
        <p class="title text-center">Login</p>

        <form #loginForm="ngForm" (ngSubmit)="login()">
          <div class="mb-3">
            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="email"
                  name="email"
                  type="email"
                  placeholder="Email"
                  pInputText
                  [(ngModel)]="userLogin.email"
                  [ngClass]="{ 'ng-invalid': errorEmail }"
                  required
                />
                <small class="p-error" [ngClass]="{ 'd-none': !errorEmail }">{{
                  errorEmail
                }}</small>
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <div>
                  <input
                    id="password"
                    name="password"
                    [type]="passwordType"
                    placeholder="Password"
                    pInputText
                    [(ngModel)]="userLogin.password"
                    [ngClass]="{ 'ng-invalid': errorPassword }"
                    required
                  />
                  <span
                    class="toogle-password-clear"
                    (click)="tooglePasswordClear()"
                    ><i
                      class="fa-regular"
                      [ngClass]="{
                        'fa-eye-slash': !passwordIsClear,
                        'fa-eye': passwordIsClear
                      }"
                    ></i
                  ></span>
                </div>
                <small
                  class="p-error"
                  [ngClass]="{ 'd-none': !errorPassword }"
                  >{{ errorPassword }}</small
                >
              </div>
            </div>

            <div class="d-flex justify-content-end mt-2">
              <button
                pButton
                pRipple
                type="submit"
                class="p-button-raised p-button-primary-color btn-primary-color"
                [disabled]="!loginForm.valid"
              >
                Login
              </button>
            </div>
          </div>
        </form>
        <div>
          <button
            type="button"
            (click)="signInWithGoogle()"
            class="btn btn-google mt-3"
          >
            <img
              src="https://www.thibaultmorizet.fr/assets/logo-google.png"
              alt="logo Google"
              class="logo-google"
            />
            Login with Google</button
          ><br />
          <button class="btn btn-facebook mt-3" (click)="signInWithFB()">
            <i class="fa-brands fa-facebook mr-1"></i> Login with Facebook
          </button>
        </div>
        <p
          class="text-center text-underline pointer"
          (click)="toggleIsLoginPage()"
        >
          You're not registered
        </p>
      </div>
    </div>
    <div class="container" *ngIf="!connectedUser.id && !isLoginPage">
      <div class="register-container">
        <p class="title text-center">Register</p>

        <form #registerForm="ngForm" (ngSubmit)="register()">
          <div class="mb-3">
            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="lastname"
                  name="lastname"
                  type="text"
                  placeholder="Lastname"
                  pInputText
                  [(ngModel)]="userInscription.lastname"
                  [ngClass]="{ 'ng-invalid': errorLastname }"
                  required
                  (keyup)="checkLastnamePattern()"
                />
                <small
                  class="p-error"
                  [ngClass]="{ 'd-none': !errorLastname }"
                  >{{ errorLastname }}</small
                >
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="firstname"
                  name="firstname"
                  type="text"
                  placeholder="Firstname"
                  pInputText
                  [(ngModel)]="userInscription.firstname"
                  [ngClass]="{ 'ng-invalid': errorFirstname }"
                  required
                  (keyup)="checkFirstnamePattern()"
                />
                <small
                  class="p-error"
                  [ngClass]="{ 'd-none': !errorFirstname }"
                  >{{ errorFirstname }}</small
                >
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="email"
                  name="email"
                  type="email"
                  placeholder="Email"
                  pInputText
                  [(ngModel)]="userInscription.email"
                  [ngClass]="{ 'ng-invalid': errorEmail }"
                  required
                  (keyup)="checkEmailPattern()"
                />
                <small class="p-error" [ngClass]="{ 'd-none': !errorEmail }">{{
                  errorEmail
                }}</small>
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <div>
                  <input
                    id="password"
                    name="password"
                    [type]="passwordType"
                    placeholder="Password"
                    pInputText
                    [(ngModel)]="userInscription.password"
                    [ngClass]="{ 'ng-invalid': errorPassword }"
                    required
                    (keyup)="checkPasswordPattern()"
                  />
                  <span
                    class="toogle-password-clear"
                    (click)="tooglePasswordClear()"
                    ><i
                      class="fa-regular"
                      [ngClass]="{
                        'fa-eye-slash': !passwordIsClear,
                        'fa-eye': passwordIsClear
                      }"
                    ></i
                  ></span>
                </div>
                <small
                  class="p-error"
                  [ngClass]="{ 'd-none': !errorPassword }"
                  >{{ errorPassword }}</small
                >
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <div>
                  <input
                    id="passwordConfirm"
                    name="passwordConfirm"
                    [type]="passwordType"
                    placeholder="Password"
                    pInputText
                    [(ngModel)]="userInscription.passwordConfirm"
                    [ngClass]="{ 'ng-invalid': errorPasswordConfirm }"
                    required
                    (keyup)="checkPasswordConfirmPattern()"
                  />
                  <span
                    class="toogle-password-clear"
                    (click)="tooglePasswordClear()"
                    ><i
                      class="fa-regular"
                      [ngClass]="{
                        'fa-eye-slash': !passwordIsClear,
                        'fa-eye': passwordIsClear
                      }"
                    ></i
                  ></span>
                </div>
                <small
                  class="p-error"
                  [ngClass]="{ 'd-none': !errorPasswordConfirm }"
                  >{{ errorPasswordConfirm }}</small
                >
              </div>
            </div>

            <div class="d-flex justify-content-end mt-2">
              <button
                pButton
                pRipple
                type="submit"
                class="p-button-raised p-button-primary-color btn-primary-color"
                [disabled]="
                  !registerForm.valid ||
                  errorEmail ||
                  errorFirstname ||
                  errorLastname ||
                  errorPassword ||
                  errorPasswordConfirm
                "
              >
                Register
              </button>
            </div>
          </div>
        </form>

        <div>
          <button
            type="button"
            (click)="signInWithGoogle()"
            class="btn btn-google mt-3"
          >
            <img
              src="https://www.thibaultmorizet.fr/assets/logo-google.png"
              alt="logo Google"
              class="logo-google"
            />
            Register with Google</button
          ><br />
          <button class="btn btn-facebook mt-3" (click)="signInWithFB()">
            <i class="fa-brands fa-facebook mr-1"></i> Register with Facebook
          </button>
        </div>
        <p
          class="text-center text-underline pointer"
          (click)="toggleIsLoginPage()"
        >
          You already have an account
        </p>
      </div>
    </div>
    <div class="container" *ngIf="connectedUser.id">
      <img
        id="personnalDateImg"
        src="./../../../assets/personalData.png"
        alt="personnalDataImg"
      />
      <div id="personnalData" class="my-3">
        <button type="button" (click)="logout()" class="btn btn-outline-danger">
          Logout
        </button>
        <div class="container d-flex justify-content-end">
          <form
            #personnalDataForm="ngForm"
            role="personnalData"
            (ngSubmit)="setNewPersonnalData()"
          >
            <div class="input-group">
              <input
                type="text"
                placeholder="{{ connectedUser.firstname }}"
                class="form-control"
                value="{{ connectedUser.firstname }}"
                [(ngModel)]="newUserData.firstname"
                name="Firstname"
              />
            </div>
            <div class="input-group">
              <input
                type="text"
                placeholder="{{ connectedUser.lastname }}"
                class="form-control"
                value="{{ connectedUser.lastname }}"
                [(ngModel)]="newUserData.lastname"
                name="Lastname"
              />
            </div>
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                value="{{ connectedUser.email }}"
                name="Email"
                disabled
              />
            </div>
            <div class="input-group">
              <input
                type="password"
                placeholder="Insérez votre nouveau mot de passe"
                class="form-control"
                value=""
                [(ngModel)]="newUserData.password"
                name="Password"
              />
            </div>
            <div *ngIf="errorPassword" class="mb-2 text-danger">
              {{ errorPassword }}
            </div>
            <div class="input-group">
              <input
                type="password"
                placeholder="Confirmez votre nouveau mot de passe"
                class="form-control"
                value=""
                [(ngModel)]="newUserData.passwordConfirm"
                name="PasswordConfirm"
              />
            </div>
            <button
              type="submit"
              class="btn btn-primary button-update-personnal-data h-100"
            >
              Modifier
            </button>
          </form>

          <form
            #AddressBillingForm="ngForm"
            role="AddressBilling"
            (ngSubmit)="setNewAddressBilling()"
          >
            <label for="Street">Rue</label>
            <div class="input-group">
              <input
                type="text"
                placeholder="{{ connectedUser.billingAddress?.street }}"
                class="form-control"
                value="{{ connectedUser.billingAddress?.street }}"
                [(ngModel)]="newAddressBilling.street"
                name="Street"
                required
              />
            </div>

            <label for="Postalcode">Code postal</label>
            <div class="input-group">
              <input
                type="text"
                placeholder="{{ connectedUser.billingAddress?.postalcode }}"
                class="form-control"
                value="{{ connectedUser.billingAddress?.postalcode }}"
                [(ngModel)]="newAddressBilling.postalcode"
                name="Postalcode"
                required
              />
            </div>

            <label for="City">Ville</label>
            <div class="input-group">
              <input
                type="text"
                placeholder="{{ connectedUser.billingAddress?.city }}"
                class="form-control"
                value="{{ connectedUser.billingAddress?.city }}"
                [(ngModel)]="newAddressBilling.city"
                name="City"
                required
              />
            </div>
            <label for="Country">Pays</label>
            <div class="input-group">
              <input
                type="text"
                placeholder="{{ connectedUser.billingAddress?.country }}"
                class="form-control"
                value="{{ connectedUser.billingAddress?.country }}"
                [(ngModel)]="newAddressBilling.country"
                name="Country"
                required
              />
            </div>

            <button
              type="submit"
              class="btn btn-primary button-update-billing-address h-100"
              [disabled]="!AddressBillingForm.valid"
            >
              Modifier
            </button>
          </form>

          <form
            #AddressDeliveryForm="ngForm"
            role="AddressDelivery"
            (ngSubmit)="setNewAddressDelivery()"
          >
            <label for="Street">Rue</label>
            <div class="input-group">
              <input
                type="text"
                placeholder="{{ connectedUser.deliveryAddress?.street }}"
                class="form-control"
                value="{{ connectedUser.deliveryAddress?.street }}"
                [(ngModel)]="newAddressDelivery.street"
                name="Street"
                required
              />
            </div>

            <label for="Postalcode">Code postal</label>
            <div class="input-group">
              <input
                type="text"
                placeholder="{{ connectedUser.deliveryAddress?.postalcode }}"
                class="form-control"
                value="{{ connectedUser.deliveryAddress?.postalcode }}"
                [(ngModel)]="newAddressDelivery.postalcode"
                name="Postalcode"
                required
              />
            </div>

            <label for="City">Ville</label>
            <div class="input-group">
              <input
                type="text"
                placeholder="{{ connectedUser.deliveryAddress?.city }}"
                class="form-control"
                value="{{ connectedUser.deliveryAddress?.city }}"
                [(ngModel)]="newAddressDelivery.city"
                name="City"
                required
              />
            </div>

            <label for="Country">Pays</label>
            <div class="input-group">
              <input
                type="text"
                placeholder="{{ connectedUser.deliveryAddress?.country }}"
                class="form-control"
                value="{{ connectedUser.deliveryAddress?.country }}"
                [(ngModel)]="newAddressDelivery.country"
                name="Country"
                required
              />
            </div>

            <button
              type="submit"
              class="btn btn-primary button-update-delivery-address h-100"
              [disabled]="!AddressDeliveryForm.valid"
            >
              Modifier
            </button>
          </form>
        </div>
      </div>
    </div>
  </main>
  <app-footer></app-footer>
</div>
