<div class="general-content">
  <app-header [cartLength]="cart.length"></app-header>

  <main id="content">
    <div class="container" *ngIf="!connectedUser.id && isLoginPage">
      <div class="login-container">
        <p class="title text-center">Login</p>

        <form #loginForm="ngForm" (ngSubmit)="login()">
          <div class="mb-3">
            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="email"
                  name="email"
                  type="email"
                  placeholder="Email"
                  pInputText
                  [(ngModel)]="userLogin.email"
                  [ngClass]="{ 'ng-invalid': errorEmail }"
                  required
                />
                <small class="p-error" [ngClass]="{ 'd-none': !errorEmail }">{{
                  errorEmail
                }}</small>
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <div>
                  <input
                    id="password"
                    name="password"
                    [type]="passwordType"
                    placeholder="Password"
                    pInputText
                    [(ngModel)]="userLogin.password"
                    [ngClass]="{ 'ng-invalid': errorPassword }"
                    required
                  />
                  <span
                    class="toogle-password-clear"
                    (click)="tooglePasswordClear()"
                    ><i
                      class="fa-regular"
                      [ngClass]="{
                        'fa-eye-slash': !passwordIsClear,
                        'fa-eye': passwordIsClear
                      }"
                    ></i
                  ></span>
                </div>
                <small
                  class="p-error"
                  [ngClass]="{ 'd-none': !errorPassword }"
                  >{{ errorPassword }}</small
                >
              </div>
            </div>

            <div class="d-flex justify-content-end mt-2">
              <button
                pButton
                pRipple
                type="submit"
                class="p-button-raised p-button-primary-color btn-primary-color"
                [disabled]="!loginForm.valid"
              >
                Login
              </button>
            </div>
          </div>
        </form>
        <div>
          <button
            type="button"
            (click)="signInWithGoogle()"
            class="btn btn-google mt-3"
          >
            <img
              src="https://www.thibaultmorizet.fr/assets/logo-google.png"
              alt="logo Google"
              class="logo-google"
            />
            Login with Google</button
          ><br />
          <button class="btn btn-facebook mt-3" (click)="signInWithFB()">
            <i class="fa-brands fa-facebook mr-1"></i> Login with Facebook
          </button>
        </div>
        <p
          class="text-center text-underline pointer"
          (click)="toggleIsLoginPage()"
        >
          You're not registered
        </p>
      </div>
    </div>
    <div class="container" *ngIf="!connectedUser.id && !isLoginPage">
      <div class="register-container">
        <p class="title text-center">Register</p>

        <form #registerForm="ngForm" (ngSubmit)="register()">
          <div class="mb-3">
            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="lastname"
                  name="lastname"
                  type="text"
                  placeholder="Lastname"
                  pInputText
                  [(ngModel)]="userInscription.lastname"
                  [ngClass]="{ 'ng-invalid': errorLastname }"
                  required
                  (keyup)="checkLastnamePattern()"
                />
                <small
                  class="p-error"
                  [ngClass]="{ 'd-none': !errorLastname }"
                  >{{ errorLastname }}</small
                >
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="firstname"
                  name="firstname"
                  type="text"
                  placeholder="Firstname"
                  pInputText
                  [(ngModel)]="userInscription.firstname"
                  [ngClass]="{ 'ng-invalid': errorFirstname }"
                  required
                  (keyup)="checkFirstnamePattern()"
                />
                <small
                  class="p-error"
                  [ngClass]="{ 'd-none': !errorFirstname }"
                  >{{ errorFirstname }}</small
                >
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="email"
                  name="email"
                  type="email"
                  placeholder="Email"
                  pInputText
                  [(ngModel)]="userInscription.email"
                  [ngClass]="{ 'ng-invalid': errorEmail }"
                  required
                  (keyup)="checkEmailPattern()"
                />
                <small class="p-error" [ngClass]="{ 'd-none': !errorEmail }">{{
                  errorEmail
                }}</small>
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <div>
                  <input
                    id="password"
                    name="password"
                    [type]="passwordType"
                    placeholder="Password"
                    pInputText
                    [(ngModel)]="userInscription.password"
                    [ngClass]="{ 'ng-invalid': errorPassword }"
                    required
                    (keyup)="checkPasswordPattern()"
                  />
                  <span
                    class="toogle-password-clear"
                    (click)="tooglePasswordClear()"
                    ><i
                      class="fa-regular"
                      [ngClass]="{
                        'fa-eye-slash': !passwordIsClear,
                        'fa-eye': passwordIsClear
                      }"
                    ></i
                  ></span>
                </div>
                <small
                  class="p-error"
                  [ngClass]="{ 'd-none': !errorPassword }"
                  >{{ errorPassword }}</small
                >
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <div>
                  <input
                    id="passwordConfirm"
                    name="passwordConfirm"
                    [type]="passwordType"
                    placeholder="Confirm your password"
                    pInputText
                    [(ngModel)]="userInscription.passwordConfirm"
                    [ngClass]="{ 'ng-invalid': errorPasswordConfirm }"
                    required
                    (keyup)="checkPasswordConfirmPattern()"
                  />
                  <span
                    class="toogle-password-clear"
                    (click)="tooglePasswordClear()"
                    ><i
                      class="fa-regular"
                      [ngClass]="{
                        'fa-eye-slash': !passwordIsClear,
                        'fa-eye': passwordIsClear
                      }"
                    ></i
                  ></span>
                </div>
                <small
                  class="p-error"
                  [ngClass]="{ 'd-none': !errorPasswordConfirm }"
                  >{{ errorPasswordConfirm }}</small
                >
              </div>
            </div>

            <div class="d-flex justify-content-end mt-2">
              <button
                pButton
                pRipple
                type="submit"
                class="p-button-raised p-button-primary-color btn-primary-color"
                [disabled]="
                  !registerForm.valid ||
                  errorEmail ||
                  errorFirstname ||
                  errorLastname ||
                  errorPassword ||
                  errorPasswordConfirm
                "
              >
                Register
              </button>
            </div>
          </div>
        </form>

        <div>
          <button
            type="button"
            (click)="signInWithGoogle()"
            class="btn btn-google mt-3"
          >
            <img
              src="https://www.thibaultmorizet.fr/assets/logo-google.png"
              alt="logo Google"
              class="logo-google"
            />
            Register with Google</button
          ><br />
          <button class="btn btn-facebook mt-3" (click)="signInWithFB()">
            <i class="fa-brands fa-facebook mr-1"></i> Register with Facebook
          </button>
        </div>
        <p
          class="text-center text-underline pointer"
          (click)="toggleIsLoginPage()"
        >
          You already have an account
        </p>
      </div>
    </div>
    <div class="container" *ngIf="connectedUser.id">
      <img
        id="personnalDateImg"
        src="https://www.thibaultmorizet.fr/assets/personalData.png"
        alt="personnalDataImg"
      />
      <div>
        <p-confirmDialog
          [breakpoints]="{ '960px': '75vw', '640px': '100vw' }"
          [style]="{ width: '50vw' }"
          [baseZIndex]="10000"
          rejectButtonStyleClass="p-button-outline-danger"
          acceptButtonStyleClass="p-button-valid"
        >
        </p-confirmDialog>

        <div id="personnalData" class="my-3">
          <p-accordion>
            <p-accordionTab header="User personnal data" [selected]="true">
              <form
                #personnalDataForm="ngForm"
                role="personnalData"
                (ngSubmit)="setNewPersonnalData()"
              >
                <div class="input-group">
                  <div class="field mb-3">
                    <input
                      id="firstname"
                      name="firstname"
                      placeholder="{{ connectedUser.firstname }}"
                      type="text"
                      pInputText
                      value="{{ connectedUser.firstname }}"
                      [(ngModel)]="newUserData.firstname"
                      required
                    />
                  </div>
                </div>

                <div class="input-group">
                  <div class="field mb-3">
                    <input
                      id="lastname"
                      name="lastname"
                      placeholder="{{ connectedUser.lastname }}"
                      type="text"
                      pInputText
                      value="{{ connectedUser.lastname }}"
                      [(ngModel)]="newUserData.lastname"
                      required
                    />
                  </div>
                </div>

                <div class="input-group">
                  <div class="field mb-3">
                    <input
                      id="email"
                      name="email"
                      placeholder="{{ connectedUser.email }}"
                      type="email"
                      pInputText
                      value="{{ connectedUser.email }}"
                      [(ngModel)]="newUserData.email"
                      class="form-control"
                      disabled
                    />
                  </div>
                </div>

                <div class="input-group">
                  <div class="field mb-3">
                    <div>
                      <input
                        id="password"
                        name="password"
                        [type]="passwordType"
                        placeholder="Insert your new password"
                        pInputText
                        [(ngModel)]="newUserData.password"
                        class="form-control"
                        [ngClass]="{ 'ng-invalid': errorPassword }"
                        (keyup)="checkUpdatePasswordPattern()"
                      />
                      <span
                        class="toogle-password-clear"
                        (click)="tooglePasswordClear()"
                        ><i
                          class="fa-regular"
                          [ngClass]="{
                            'fa-eye-slash': !passwordIsClear,
                            'fa-eye': passwordIsClear
                          }"
                        ></i
                      ></span>
                    </div>
                    <small
                      class="p-error"
                      [ngClass]="{ 'd-none': !errorPassword }"
                      >{{ errorPassword }}</small
                    >
                  </div>
                </div>

                <div class="input-group">
                  <div class="field mb-3">
                    <div>
                      <input
                        id="passwordConfirm"
                        name="passwordConfirm"
                        [type]="passwordType"
                        placeholder="Confirm your new password"
                        pInputText
                        [(ngModel)]="newUserData.passwordConfirm"
                        [ngClass]="{ 'ng-invalid': errorPasswordConfirm }"
                        (keyup)="checkUpdatePasswordConfirmPattern()"
                      />
                      <span
                        class="toogle-password-clear"
                        (click)="tooglePasswordClear()"
                        ><i
                          class="fa-regular"
                          [ngClass]="{
                            'fa-eye-slash': !passwordIsClear,
                            'fa-eye': passwordIsClear
                          }"
                        ></i
                      ></span>
                    </div>
                    <small
                      class="p-error"
                      [ngClass]="{ 'd-none': !errorPasswordConfirm }"
                      >{{ errorPasswordConfirm }}</small
                    >
                  </div>
                </div>

                <div class="d-flex justify-content-end mt-2">
                  <button
                    pButton
                    pRipple
                    type="submit"
                    class="p-button-raised p-button-primary-color btn-primary-color"
                    [disabled]="
                      !personnalDataForm.valid ||
                      errorEmail ||
                      errorFirstname ||
                      errorLastname ||
                      errorPassword ||
                      errorPasswordConfirm
                    "
                  >
                    Save the changes
                  </button>
                </div>
              </form>
            </p-accordionTab>
            <p-accordionTab header="Billing address">
              <form
                #AddressBillingForm="ngForm"
                role="AddressBilling"
                (ngSubmit)="setNewAddressBilling()"
              >
                <div class="input-group">
                  <div class="field mb-3">
                    <input
                      id="street"
                      name="street"
                      placeholder="Street"
                      type="text"
                      pInputText
                      value="{{ connectedUser.billingAddress?.street }}"
                      [(ngModel)]="newAddressBilling.street"
                      required
                    />
                  </div>
                </div>

                <div class="input-group">
                  <div class="field mb-3">
                    <input
                      id="postalcode"
                      name="postalcode"
                      placeholder="Postal code"
                      type="text"
                      pInputText
                      value="{{ connectedUser.billingAddress?.postalcode }}"
                      [(ngModel)]="newAddressBilling.postalcode"
                      required
                    />
                  </div>
                </div>

                <div class="input-group">
                  <div class="field mb-3">
                    <input
                      id="city"
                      name="city"
                      placeholder="City"
                      type="text"
                      pInputText
                      value="{{ connectedUser.billingAddress?.city }}"
                      [(ngModel)]="newAddressBilling.city"
                      required
                    />
                  </div>
                </div>

                <div class="input-group">
                  <div class="field mb-3">
                    <input
                      id="country"
                      name="country"
                      placeholder="Country"
                      type="text"
                      pInputText
                      value="{{ connectedUser.billingAddress?.country }}"
                      [(ngModel)]="newAddressBilling.country"
                      required
                    />
                  </div>
                </div>

                <div class="d-flex justify-content-end mt-2">
                  <button
                    pButton
                    pRipple
                    type="submit"
                    class="p-button-raised p-button-primary-color btn-primary-color"
                    [disabled]="!AddressBillingForm.valid"
                  >
                    Save the changes
                  </button>
                </div>
              </form>
            </p-accordionTab>
            <p-accordionTab header="Delivery address">
              <form
                #AddressDeliveryForm="ngForm"
                role="AddressDelivery"
                (ngSubmit)="setNewAddressDelivery()"
              >
                <div class="input-group">
                  <div class="field mb-3">
                    <input
                      id="street"
                      name="street"
                      placeholder="Street"
                      type="text"
                      pInputText
                      value="{{ connectedUser.deliveryAddress?.street }}"
                      [(ngModel)]="newAddressDelivery.street"
                      required
                    />
                  </div>
                </div>

                <div class="input-group">
                  <div class="field mb-3">
                    <input
                      id="postalcode"
                      name="postalcode"
                      placeholder="Postal code"
                      type="text"
                      pInputText
                      value="{{ connectedUser.deliveryAddress?.postalcode }}"
                      [(ngModel)]="newAddressDelivery.postalcode"
                      required
                    />
                  </div>
                </div>

                <div class="input-group">
                  <div class="field mb-3">
                    <input
                      id="city"
                      name="city"
                      placeholder="City"
                      type="text"
                      pInputText
                      value="{{ connectedUser.deliveryAddress?.city }}"
                      [(ngModel)]="newAddressDelivery.city"
                      required
                    />
                  </div>
                </div>

                <div class="input-group">
                  <div class="field mb-3">
                    <input
                      id="country"
                      name="country"
                      placeholder="Country"
                      type="text"
                      pInputText
                      value="{{ connectedUser.deliveryAddress?.country }}"
                      [(ngModel)]="newAddressDelivery.country"
                      required
                    />
                  </div>
                </div>

                <div class="d-flex justify-content-end mt-2">
                  <button
                    pButton
                    pRipple
                    type="submit"
                    class="p-button-raised p-button-primary-color btn-primary-color"
                    [disabled]="!AddressDeliveryForm.valid"
                  >
                    Save the changes
                  </button>
                </div>
              </form>
            </p-accordionTab>
          </p-accordion>
          <div class="w-100 d-flex justify-content-around">
            <button
              type="button"
              (click)="confirmDeleteAccount()"
              class="btn btn-danger mt-3"
            >
              Delete my account
            </button>

            <button
              type="button"
              (click)="logout()"
              class="btn btn-outline-danger mt-3"
            >
              Logout
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>
  <app-footer></app-footer>
</div>
