<div class="general-content">
  <app-header [cartLength]="cart.length"></app-header>

  <main id="content">
    <div class="container">
      <p-dialog
        header="Delivery address"
        [(visible)]="displayModalDeliveryAddress"
        [draggable]="false"
        [resizable]="false"
        [breakpoints]="{ '960px': '75vw' }"
        [style]="{ width: '50vw' }"
        [blockScroll]="true"
        [modal]="true"
        [dismissableMask]="true"
        closeIcon="pi pi-times delivery-modal-close"
        ><div class="mt-3">
          <form
            #AddressDeliveryForm="ngForm"
            role="AddressDelivery"
            (ngSubmit)="setNewAddressDelivery()"
          >
            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="street"
                  name="street"
                  placeholder="Street"
                  type="text"
                  pInputText
                  value="{{ connectedUser.deliveryAddress?.street }}"
                  [(ngModel)]="newAddressDelivery.street"
                  required
                />
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="postalcode"
                  name="postalcode"
                  placeholder="Postal code"
                  type="text"
                  pInputText
                  value="{{ connectedUser.deliveryAddress?.postalcode }}"
                  [(ngModel)]="newAddressDelivery.postalcode"
                  required
                />
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="city"
                  name="city"
                  placeholder="City"
                  type="text"
                  pInputText
                  value="{{ connectedUser.deliveryAddress?.city }}"
                  [(ngModel)]="newAddressDelivery.city"
                  required
                />
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="country"
                  name="country"
                  placeholder="Country"
                  type="text"
                  pInputText
                  value="{{ connectedUser.deliveryAddress?.country }}"
                  [(ngModel)]="newAddressDelivery.country"
                  required
                />
              </div>
            </div>

            <div class="d-flex justify-content-end mt-2">
              <button
                pButton
                pRipple
                type="submit"
                class="p-button-raised p-button-primary-color btn-primary-color"
                [disabled]="!AddressDeliveryForm.valid"
              >
                Save the changes
              </button>
            </div>
          </form>
        </div>
      </p-dialog>
      <p-dialog
        header="Billing address"
        [(visible)]="displayModalBillingAddress"
        [draggable]="false"
        [resizable]="false"
        [breakpoints]="{ '960px': '75vw' }"
        [style]="{ width: '50vw' }"
        [blockScroll]="true"
        [modal]="true"
        [dismissableMask]="true"
        closeIcon="pi pi-times billing-modal-close"
        ><div class="mt-3">
          <form
            #AddressBillingForm="ngForm"
            role="AddressBilling"
            (ngSubmit)="setNewAddressBilling()"
          >
            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="street"
                  name="street"
                  placeholder="Street"
                  type="text"
                  pInputText
                  value="{{ connectedUser.billingAddress?.street }}"
                  [(ngModel)]="newAddressBilling.street"
                  required
                />
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="postalcode"
                  name="postalcode"
                  placeholder="Postal code"
                  type="text"
                  pInputText
                  value="{{ connectedUser.billingAddress?.postalcode }}"
                  [(ngModel)]="newAddressBilling.postalcode"
                  required
                />
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="city"
                  name="city"
                  placeholder="City"
                  type="text"
                  pInputText
                  value="{{ connectedUser.billingAddress?.city }}"
                  [(ngModel)]="newAddressBilling.city"
                  required
                />
              </div>
            </div>

            <div class="input-group">
              <div class="field mb-3">
                <input
                  id="country"
                  name="country"
                  placeholder="Country"
                  type="text"
                  pInputText
                  value="{{ connectedUser.billingAddress?.country }}"
                  [(ngModel)]="newAddressBilling.country"
                  required
                />
              </div>
            </div>

            <div class="d-flex justify-content-end mt-2">
              <button
                pButton
                pRipple
                type="submit"
                class="p-button-raised p-button-primary-color btn-primary-color"
                [disabled]="!AddressBillingForm.valid"
              >
                Save the changes
              </button>
            </div>
          </form>
        </div>
      </p-dialog>
      <div class="cart-details-general">
        <p class="cart-title">Your cart total is {{ cartTotalPriceTtc }} €</p>
        <p-divider></p-divider>
        <div *ngFor="let elt of cart">
          <div class="cart-details">
            <a [routerLink]="['/books/' + elt.id]">
              <img src="{{ elt.image }}" alt="" class="img-icon"
            /></a>
            <div class="cart-details-info">
              <div class="cart-details-title-quantity-price">
                <p class="cart-details-title">
                  <a [routerLink]="['/books/' + elt.id]"> {{ elt.title }}</a>
                </p>
                <div class="cart-details-quantity-price">
                  <p-inputNumber
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    inputId="horizontal"
                    spinnerMode="horizontal"
                    [allowEmpty]="false"
                    [step]="1"
                    [(ngModel)]="elt.number_ordered"
                    [min]="1"
                    [max]="elt.stock ? elt.stock : 0"
                    decrementButtonClass="p-button-outline-primary"
                    incrementButtonClass="p-button-outline-primary"
                    incrementButtonIcon="pi pi-plus"
                    decrementButtonIcon="pi pi-minus"
                    (onInput)="updateQuantity(elt.id, $event.value)"
                  >
                  </p-inputNumber>
                  <div class="cart-details-price-remove">
                    <p class="cart-details-price">
                      {{ elt.unitpricettc }} € (TTC)
                    </p>
                    <p
                      class="cart-details-remove"
                      (click)="deleteBookOfCart(elt.id)"
                    >
                      Remove
                    </p>
                  </div>
                </div>
              </div>
              <div class="cart-details-minor-info">
                <p>
                  <i class="pi pi-send"></i
                  ><span
                    >Delivery by
                    <span class="bold"> {{ deliveryDate }}.</span></span
                  >
                </p>
                <p *ngIf="elt.stock && elt.stock <= 10">
                  <i class="pi pi-exclamation-triangle"></i
                  ><span
                    >Only
                    <span class="bold">{{ elt.stock }}</span> Available.</span
                  >
                </p>
              </div>
            </div>
          </div>
          <p-divider class="cart-details-divider"></p-divider>
        </div>
        <div class="cart-details-addresses">
          <div
            class="cart-details-delivery-address"
            *ngIf="connectedUser?.deliveryAddress"
          >
            <div
              class="cart-details-delivery-address-title"
              (click)="showModalDeliveryAddress()"
            >
              Delivery address
            </div>
            <div>
              {{ connectedUser.deliveryAddress?.street }}
            </div>
            <div>
              {{ connectedUser.deliveryAddress?.postalcode }}
              {{ connectedUser.deliveryAddress?.city }}
            </div>
            <div>
              {{ connectedUser.deliveryAddress?.country }}
            </div>
            <p-divider class="cart-details-divider"></p-divider>
          </div>
          <div
            class="cart-details-delivery-address"
            *ngIf="!connectedUser?.deliveryAddress"
          >
            <div class="d-flex justify-content-start mt-2">
              <button
                pButton
                pRipple
                type="submit"
                class="p-button-raised p-button-primary-color btn-primary-color"
                (click)="showModalDeliveryAddress()"
              >
                Add delivery address
              </button>
            </div>
            <p-divider class="cart-details-divider"></p-divider>
          </div>
          <div
            class="cart-details-billing-address"
            *ngIf="connectedUser?.billingAddress"
          >
            <div
              class="cart-details-billing-address-title"
              (click)="showModalBillingAddress()"
            >
              Billing address
            </div>
            <div>
              {{ connectedUser.billingAddress?.street }}
            </div>
            <div>
              {{ connectedUser.billingAddress?.postalcode }}
              {{ connectedUser.billingAddress?.city }}
            </div>
            <div>
              {{ connectedUser.billingAddress?.country }}
            </div>
            <p-divider class="cart-details-divider"></p-divider>
          </div>
          <div
            class="cart-details-billing-address"
            *ngIf="!connectedUser?.billingAddress"
          >
            <div class="d-flex justify-content-start mt-2">
              <button
                pButton
                pRipple
                type="submit"
                class="p-button-raised p-button-primary-color btn-primary-color"
                (click)="showModalBillingAddress()"
              >
                Add billing address
              </button>
            </div>
            <p-divider class="cart-details-divider"></p-divider>
          </div>
        </div>
        <div class="cart-details-total-subtotal">
          <div class="cart-details-subtotal">
            <div>
              <p>Subtotal (TTC)</p>
              <p>{{ cartTotalPriceTtc }} €</p>
            </div>
            <!-- <div>
            <p>Subtotal (HT)</p>
            <p>{{ cartTotalPriceHt }} €</p>
          </div> -->
            <div>
              <p>Delivery taxes</p>
              <p>Free</p>
            </div>
            <p-divider class="cart-details-divider"></p-divider>
          </div>

          <div class="cart-details-total">
            <div>
              <p>Total</p>
              <p>{{ cartTotalPriceTtc }} €</p>
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-end mt-2">
          <button
            pButton
            pRipple
            type="submit"
            class="p-button-raised p-button-primary-color btn-primary-color"
            [disabled]="
              !connectedUser.deliveryAddress || !connectedUser.billingAddress
            "
          >
            <span
              pTooltip="Create valid addresses to check out"
              [tooltipDisabled]="
                connectedUser.deliveryAddress != undefined &&
                connectedUser.billingAddress != undefined
              "
              >Check out</span
            >
          </button>
        </div>
      </div>
    </div>
  </main>
  <app-footer></app-footer>
</div>
